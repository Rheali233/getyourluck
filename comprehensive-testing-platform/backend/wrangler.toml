name = "selfatlas-backend"
main = "src/index.ts"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]
account_id = "257a0c6111ab57bbec3f4e18492c6ac9"

[observability]
# 开启 Workers Logs，便于线上快速定位 500 报错
enabled = true
head_sampling_rate = 1

[env.production]
name = "selfatlas-backend-prod"
# route = "api.selfatlas.net/*"
# zone_id = "your-zone-id"

[env.staging]
name = "selfatlas-backend-staging"

[env.staging.observability]
enabled = true
head_sampling_rate = 1

[env.development]
name = "selfatlas-backend-dev"
# route = "dev-api.selfatlas.net/*"
# zone_id = "your-zone-id"

# D1数据库配置
# [[env.production.d1_databases]]
# binding = "DB"
# database_name = "getyourluck-prod"
# database_id = "your-production-database-id"

[[env.staging.d1_databases]]
binding = "DB"
database_name = "getyourluck-staging"
database_id = "ad5be588-a683-45b5-94b4-47c585abd34f"

# [[env.development.d1_databases]]
# binding = "DB"
# database_name = "getyourluck-dev"
# database_id = "your-development-database-id"

# 本地开发D1数据库配置
[[d1_databases]]
binding = "DB"
database_name = "selfatlas-local"
database_id = "a9f563cf-ce1b-46f8-adfe-38d58c7686a0"

# Production D1数据库配置（用于迁移）
[[d1_databases]]
binding = "selfatlas_prod"
database_name = "selfatlas-prod"
database_id = "56cb8ab0-f7da-4ec9-90b7-84dd832e1803"

# Staging D1数据库配置（使用现有的getyourluck-staging）
[[d1_databases]]
binding = "getyourluck_staging"
database_name = "getyourluck-staging"
database_id = "ad5be588-a683-45b5-94b4-47c585abd34f"

# KV存储配置
# [[env.production.kv_namespaces]]
# binding = "CACHE"
# id = "your-production-kv-id"
# preview_id = "your-production-kv-preview-id"

[[env.staging.kv_namespaces]]
binding = "CACHE"
id = "439757d0175e4f89a4b57a2c82ccf464"
preview_id = "439757d0175e4f89a4b57a2c82ccf464"

# [[env.development.kv_namespaces]]
# binding = "CACHE"
# id = "your-development-kv-id"
# preview_id = "your-development-kv-preview-id"

# R2存储配置
# [[env.production.r2_buckets]]
# binding = "STORAGE"
# bucket_name = "getyourluck-prod-storage"

[[env.staging.r2_buckets]]
binding = "STORAGE"
bucket_name = "selfatlas-staging-storage"

# [[env.development.r2_buckets]]
# binding = "STORAGE"
# bucket_name = "getyourluck-dev-storage"

# Production环境D1数据库配置
[[env.production.d1_databases]]
binding = "DB"
database_name = "selfatlas-prod"
database_id = "56cb8ab0-f7da-4ec9-90b7-84dd832e1803"

# Production环境KV存储配置
[[env.production.kv_namespaces]]
binding = "CACHE"
id = "ea8ee69d73834f1c9d0c791103e191dc"

# Production环境R2存储配置
[[env.production.r2_buckets]]
binding = "STORAGE"
bucket_name = "selfatlas-prod-storage"

# 环境变量
[env.production.vars]
NODE_ENV = "production"
LOG_LEVEL = "info"
ENABLE_ANALYTICS = "true"
ENABLE_CACHE = "true"
CACHE_TTL = "3600"
MAX_REQUEST_SIZE = "1048576"
RATE_LIMIT_WINDOW = "60000"
RATE_LIMIT_MAX = "100"

[env.staging.vars]
NODE_ENV = "staging"
LOG_LEVEL = "info"
ENABLE_ANALYTICS = "true"
ENABLE_CACHE = "true"
CACHE_TTL = "1800"
MAX_REQUEST_SIZE = "1048576"
RATE_LIMIT_WINDOW = "60000"
RATE_LIMIT_MAX = "200"

[env.development.vars]
NODE_ENV = "development"
LOG_LEVEL = "debug"
ENABLE_ANALYTICS = "false"
ENABLE_CACHE = "false"
CACHE_TTL = "300"
MAX_REQUEST_SIZE = "2097152"
RATE_LIMIT_WINDOW = "60000"
RATE_LIMIT_MAX = "1000"
# DEEPSEEK_API_KEY = "your-api-key-here"  # 通过 wrangler secret put 设置

# 构建配置 - 使用默认的 TypeScript 构建

# 性能配置
[env.production.performance]
cpu = "high"
memory = "high"

[env.staging.performance]
cpu = "medium"
memory = "medium"

[env.development.performance]
cpu = "low"
memory = "low"