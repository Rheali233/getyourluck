# ç¯å¢ƒé…ç½®ä¿®å¤å®Œæˆæ€»ç»“

## âœ… å·²å®Œæˆçš„ä¿®å¤

### 1. ä¿®å¤ Pages Functions ä»£ç†é€»è¾‘ âœ…
**æ–‡ä»¶**: `frontend/functions/api/_middleware.js`

**ä¿®å¤å†…å®¹**:
- æ ¹æ®åŸŸååŠ¨æ€é€‰æ‹©åç«¯ç¯å¢ƒ
- ç”Ÿäº§ç¯å¢ƒ (`selfatlas.net`) â†’ `selfatlas-backend-prod`
- Staging ç¯å¢ƒ (`*.pages.dev`) â†’ `selfatlas-backend-staging`
- è§£å†³äº† Staging ç¯å¢ƒç¡¬ç¼–ç ç”Ÿäº§åç«¯çš„é—®é¢˜

**å½±å“**: Staging ç¯å¢ƒç°åœ¨å®Œå…¨éš”ç¦»ï¼Œä¸ä¼šæ±¡æŸ“ç”Ÿäº§æ•°æ®åº“

---

### 2. ä¿®æ”¹å‰ç«¯ç¯å¢ƒé…ç½® âœ…
**æ–‡ä»¶**: `frontend/src/config/environment.ts`

**ä¿®å¤å†…å®¹**:
- **å¼€å‘ç¯å¢ƒ**: ä½¿ç”¨ç›¸å¯¹è·¯å¾„ `/api`ï¼Œé€šè¿‡ Vite ä»£ç†åˆ°æœ¬åœ°åç«¯ (`localhost:8787`)
- **Staging ç¯å¢ƒ**: ä½¿ç”¨ç›¸å¯¹è·¯å¾„ `/api`ï¼Œé€šè¿‡ Pages Functions ä»£ç†åˆ° staging åç«¯
- **ç”Ÿäº§ç¯å¢ƒ**: ä½¿ç”¨ç›¸å¯¹è·¯å¾„ `/api`ï¼Œé€šè¿‡ Pages Functions ä»£ç†åˆ°ç”Ÿäº§åç«¯
- **CDN é…ç½®**: ç»Ÿä¸€ä½¿ç”¨ Pages CDNï¼ˆStaging å’Œ Productionï¼‰

**å½±å“**: 
- å¼€å‘ç¯å¢ƒå®Œå…¨éš”ç¦»ï¼Œä¸ä¼šå½±å“è¿œç¨‹ç¯å¢ƒ
- Staging å’Œ Production çš„ CDN é…ç½®ä¸€è‡´

---

### 3. Vite ä»£ç†é…ç½® âœ…
**æ–‡ä»¶**: `frontend/vite.config.ts`

**çŠ¶æ€**: é…ç½®å·²æ­£ç¡®ï¼Œæ— éœ€ä¿®æ”¹
- å·²é…ç½® `/api` ä»£ç†åˆ° `http://localhost:8787`
- å¼€å‘ç¯å¢ƒä¼šè‡ªåŠ¨ä½¿ç”¨æ­¤ä»£ç†

---

### 4. åˆ›å»ºæœ¬åœ°ç¯å¢ƒåˆå§‹åŒ–è„šæœ¬ âœ…
**æ–‡ä»¶**: `backend/scripts/init-local.sh`

**åŠŸèƒ½**:
- æ£€æŸ¥å¹¶åˆ›å»ºæœ¬åœ°æ•°æ®åº“
- è¿è¡Œæ•°æ®åº“è¿ç§»
- åˆå§‹åŒ–ç§å­æ•°æ®
- æä¾›æ¸…æ™°çš„æ“ä½œæŒ‡å¼•

**ä½¿ç”¨æ–¹æ³•**:
```bash
cd backend
npm run init:local
```

---

### 5. æ›´æ–°åç«¯ package.json âœ…
**æ–‡ä»¶**: `backend/package.json`

**æ–°å¢è„šæœ¬**:
- `npm run init:local` - åˆå§‹åŒ–æœ¬åœ°å¼€å‘ç¯å¢ƒ
- `npm run seed:local` - åˆå§‹åŒ–ç§å­æ•°æ®
- `npm run migrate:local` - è¿è¡Œæ•°æ®åº“è¿ç§»
- `npm run dev` - å·²æ›´æ–°ä¸ºä½¿ç”¨ `--local` æ ‡å¿—

---

### 6. æ›´æ–°éƒ¨ç½²è„šæœ¬ âœ…
**æ–‡ä»¶**: 
- `deploy-staging.sh`
- `deploy-production.sh`

**æ”¹è¿›**:
- æ·»åŠ ç¯å¢ƒé…ç½®è¯´æ˜
- å¼ºè°ƒç¯å¢ƒéš”ç¦»çš„é‡è¦æ€§
- æ›´æ–°éƒ¨ç½²åçš„éªŒè¯ä¿¡æ¯

---

## ğŸ“‹ å½“å‰ç¯å¢ƒé…ç½®çŠ¶æ€

### å¼€å‘ç¯å¢ƒ (Development)
```
å‰ç«¯: localhost:3000
  â†“ (Vite ä»£ç†)
åç«¯: localhost:8787 (æœ¬åœ° Worker)
  â†“
æ•°æ®åº“: selfatlas-local (æœ¬åœ° D1)
```
âœ… **å®Œå…¨éš”ç¦»ï¼Œä¸å½±å“è¿œç¨‹ç¯å¢ƒ**

### Staging ç¯å¢ƒ
```
å‰ç«¯: *.pages.dev
  â†“ (Pages Functions - åŠ¨æ€ä»£ç†)
åç«¯: selfatlas-backend-staging
  â†“
æ•°æ®åº“: selfatlas-staging
```
âœ… **å®Œå…¨éš”ç¦»ï¼Œä¸å½±å“ç”Ÿäº§ç¯å¢ƒ**

### ç”Ÿäº§ç¯å¢ƒ (Production)
```
å‰ç«¯: selfatlas.net
  â†“ (Pages Functions - åŠ¨æ€ä»£ç†)
åç«¯: selfatlas-backend-prod
  â†“
æ•°æ®åº“: selfatlas-prod
```
âœ… **å®Œå…¨éš”ç¦»ï¼Œæ•°æ®å®‰å…¨**

---

## âš ï¸ å¾…å¤„ç†äº‹é¡¹

### 1. æ•°æ®åº“å‘½åç»Ÿä¸€ âœ…ï¼ˆå·²å®Œæˆï¼‰
**å½“å‰çŠ¶æ€**: 
- Cloudflare Dashboard æ˜¾ç¤ºåç§°: `getyourluck-staging`ï¼ˆæ— æ³•æ›´æ”¹ï¼ŒCloudflare ä¸æ”¯æŒé‡å‘½åï¼‰
- é…ç½®æ–‡ä»¶ä¸­çš„åç§°: `selfatlas-staging` âœ…ï¼ˆå·²ç»Ÿä¸€ï¼‰
- æ‰€æœ‰è„šæœ¬å’Œæ–‡æ¡£: `selfatlas-staging` âœ…ï¼ˆå·²ç»Ÿä¸€ï¼‰

**è¯´æ˜**:
- Wrangler ä½¿ç”¨ `database_id` æ¥è¯†åˆ«æ•°æ®åº“ï¼Œè€Œä¸æ˜¯åç§°
- è™½ç„¶åœ¨ Dashboard ä¸­æ˜¾ç¤ºåç§°ä»ä¸º `getyourluck-staging`ï¼Œä½†ä¸å½±å“åŠŸèƒ½
- æ‰€æœ‰é…ç½®ã€è„šæœ¬å’Œæ–‡æ¡£å·²ç»Ÿä¸€ä½¿ç”¨ `selfatlas-staging`
- è¯¦æƒ…è¯·å‚è€ƒï¼š`docs/database-rename-guide.md`

**çŠ¶æ€**: âœ… å®Œæˆï¼ˆè™½ç„¶åœ¨ Dashboard ä¸­æ˜¾ç¤ºåç§°ä¸åŒï¼Œä½†åŠŸèƒ½å·²ç»Ÿä¸€ï¼‰

---

### 2. å®Œå–„æœ¬åœ°ç§å­æ•°æ®ï¼ˆå¯é€‰ï¼‰
**å½“å‰çŠ¶æ€**: 
- `seed-local.ts` å·²åŒ…å«å¿ƒç†æµ‹è¯•æ¨¡å—æ•°æ®
- å¯èƒ½éœ€è¦æ·»åŠ å…¶ä»–æ¨¡å—çš„æ•°æ®ï¼ˆCareer, Relationship, Learning ç­‰ï¼‰

**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­ï¼ˆå¯æ ¹æ®å¼€å‘éœ€è¦é€æ­¥å®Œå–„ï¼‰

---

## ğŸš€ ä¸‹ä¸€æ­¥æ“ä½œ

### å¯¹äºå¼€å‘è€…

1. **åˆå§‹åŒ–æœ¬åœ°ç¯å¢ƒ**:
   ```bash
   cd backend
   npm run init:local
   ```

2. **å¯åŠ¨å¼€å‘ç¯å¢ƒ**:
   ```bash
   # ç»ˆç«¯ 1: å¯åŠ¨åç«¯
   cd backend
   npm run dev

   # ç»ˆç«¯ 2: å¯åŠ¨å‰ç«¯
   cd frontend
   npm run dev
   ```

3. **è®¿é—®åº”ç”¨**:
   - å‰ç«¯: http://localhost:3000
   - åç«¯: http://localhost:8787

### å¯¹äºéƒ¨ç½²

1. **Staging ç¯å¢ƒéƒ¨ç½²**:
   ```bash
   ./deploy-staging.sh
   ```
   - ç°åœ¨ä¼šè‡ªåŠ¨ä½¿ç”¨ staging åç«¯ï¼ˆä¸å†æ±¡æŸ“ç”Ÿäº§ç¯å¢ƒï¼‰

2. **ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²**:
   ```bash
   ./deploy-production.sh
   ```
   - ä»ç„¶ä½¿ç”¨ç”Ÿäº§åç«¯ï¼Œå®Œå…¨éš”ç¦»

---

## âœ… éªŒè¯æ¸…å•

éƒ¨ç½²åè¯·éªŒè¯ï¼š

- [ ] å¼€å‘ç¯å¢ƒï¼šå‰ç«¯èƒ½æ­£ç¡®è®¿é—®æœ¬åœ°åç«¯
- [ ] å¼€å‘ç¯å¢ƒï¼šæœ¬åœ°æ•°æ®åº“æœ‰ç§å­æ•°æ®
- [ ] Staging ç¯å¢ƒï¼šå‰ç«¯é€šè¿‡ Pages Functions è®¿é—® staging åç«¯
- [ ] Staging ç¯å¢ƒï¼šä¸ä¼šè®¿é—®ç”Ÿäº§æ•°æ®åº“
- [ ] ç”Ÿäº§ç¯å¢ƒï¼šå‰ç«¯é€šè¿‡ Pages Functions è®¿é—®ç”Ÿäº§åç«¯
- [ ] ä¸‰ä¸ªç¯å¢ƒå®Œå…¨éš”ç¦»ï¼Œæ•°æ®ä¸ä¼šäº’ç›¸æ±¡æŸ“

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- è¯¦ç»†é…ç½®æ–¹æ¡ˆ: `docs/environment-configuration-plan.md`
- API URL æŒ‡å—: `frontend/API_URL_GUIDE.md`

---

## ğŸ‰ ä¿®å¤å®Œæˆ

æ‰€æœ‰å…³é”®ä¿®å¤å·²å®Œæˆï¼ä¸‰ä¸ªç¯å¢ƒç°åœ¨å®Œå…¨ç‹¬ç«‹ï¼Œä¸ä¼šäº’ç›¸å½±å“ã€‚

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒè¯¦ç»†é…ç½®æ–‡æ¡£æˆ–è”ç³»å›¢é˜Ÿã€‚

